<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;700&display=swap');
        
        :root {
            --wa-bg-dark: #0b141a;
            --wa-header-dark: #111b21;
            --wa-green: #00a884;
            --wa-text-primary: #e9edef;
            --wa-text-secondary: #8696a0;
            --wa-chat-bubble-me: #005c4b;
            --wa-chat-bubble-them: #202c33;
            --wa-link-green: #53bdeb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--wa-bg-dark);
            color: var(--wa-text-primary);
            height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* WHATSAPP DARK UI */
        .dark-header { background-color: var(--wa-header-dark); }
        .tab-active { border-bottom: 3px solid var(--wa-green); color: var(--wa-green); }
        
        .chat-list-item:active { background-color: #202c33; }
        
        /* 3-DOT MENU DROPDOWN */
        #menu-dropdown {
            background-color: #233138;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            border-radius: 4px;
            z-index: 500;
        }

        /* PROFILE SCREEN (Exact matching provided photo) */
        .profile-view { background-color: #111b21; }
        .edit-green { color: #00a884; font-weight: 500; }
        .profile-icon { color: #8696a0; font-size: 20px; }

        /* CHAT BUBBLES */
        .msg-box {
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 4px;
            font-size: 15px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.2);
            position: relative;
        }
        .msg-me { background-color: var(--wa-chat-bubble-me); align-self: flex-end; }
        .msg-them { background-color: var(--wa-chat-bubble-them); align-self: flex-start; }

        #app-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: 100vh;
        }

        @media (max-width: 850px) {
            #app-grid { grid-template-columns: 1fr; }
            .chat-viewport { position: fixed; inset: 0; z-index: 100; display: none; }
            .chat-viewport.active { display: flex; }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="auth-screen" class="fixed inset-0 bg-[#111b21] flex items-center justify-center p-6 z-[1000]">
        <div class="w-full max-w-sm text-center space-y-8">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="w-20 mx-auto" alt="WA">
            <h1 class="text-2xl font-bold text-gray-100">Welcome to WhatsApp</h1>
            
            <div id="auth-box" class="space-y-4">
                <div id="reg-fields" class="hidden space-y-4">
                    <input type="text" id="r-name" placeholder="Full Name" class="w-full p-4 bg-[#2a3942] text-white border-b-2 border-[#00a884] outline-none rounded-t-lg">
                    <input type="text" id="r-user" placeholder="Username" class="w-full p-4 bg-[#2a3942] text-white border-b-2 border-[#00a884] outline-none">
                    <input type="password" id="r-pass" placeholder="Password" class="w-full p-4 bg-[#2a3942] text-white border-b-2 border-[#00a884] outline-none rounded-b-lg">
                    <div class="p-4 border-2 border-dashed border-[#8696a0] rounded-lg text-[#00a884] font-bold">
                        <label class="cursor-pointer">Upload Profile Photo<input type="file" id="r-dp" class="hidden" onchange="readDP(this)"></label>
                    </div>
                </div>

                <div id="login-fields" class="space-y-4">
                    <input type="text" id="l-user" placeholder="Username" class="w-full p-4 bg-[#2a3942] text-white border-b-2 border-[#00a884] outline-none rounded-t-lg">
                    <input type="password" id="l-pass" placeholder="Password" class="w-full p-4 bg-[#2a3942] text-white border-b-2 border-[#00a884] outline-none rounded-b-lg">
                </div>

                <button onclick="handleSystemAuth()" class="w-full bg-[#00a884] text-white font-bold py-4 rounded shadow-lg active:scale-95 transition">CONTINUE</button>
                <p id="toggle-label" class="text-sm text-[#00a884] font-bold cursor-pointer" onclick="switchAuthMode(true)">New to WhatsApp? Register</p>
                <button onclick="localStorage.clear(); location.reload();" class="mt-20 text-[10px] text-gray-500 uppercase tracking-widest block w-full">Emergency Reset</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden h-full">
        <div id="app-grid">
            
            <aside class="flex flex-col h-full bg-[#111b21] border-r border-[#202c33]">
                <div class="dark-header p-4 flex justify-between items-center h-16">
                    <h2 class="text-xl font-medium text-[#e9edef]">WhatsApp</h2>
                    <div class="flex space-x-6 text-[#8696a0] relative">
                        <i class="fas fa-camera"></i>
                        <i class="fas fa-search"></i>
                        <i class="fas fa-ellipsis-v cursor-pointer" onclick="toggleMenu()"></i>
                        
                        <div id="menu-dropdown" class="hidden absolute top-8 right-0 w-48 py-2">
                            <div class="px-6 py-3 hover:bg-[#111b21] text-sm text-[#e9edef] cursor-pointer" onclick="viewMyProfile()">Settings</div>
                            <div class="px-6 py-3 hover:bg-[#111b21] text-sm text-[#e9edef] cursor-pointer" onclick="showNewChatModal()">New Chat</div>
                            <div class="px-6 py-3 hover:bg-[#111b21] text-sm text-[#e9edef] cursor-pointer" onclick="logout()">Logout</div>
                        </div>
                    </div>
                </div>

                <div class="dark-header flex text-center text-sm font-bold text-[#8696a0] h-12">
                    <div class="flex-1 flex items-center justify-center tab-active">CHATS</div>
                    <div class="flex-1 flex items-center justify-center">STATUS</div>
                    <div class="flex-1 flex items-center justify-center">CALLS</div>
                </div>

                <div id="chat-threads-wall" class="flex-1 overflow-y-auto no-scrollbar">
                    </div>
            </aside>

            <section class="chat-viewport flex flex-col h-full bg-[#0b141a] relative border-l border-[#202c33]">
                <div id="no-chat" class="absolute inset-0 z-10 flex flex-col items-center justify-center text-center p-10 bg-[#222e35]">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="w-32 opacity-10 mb-8" alt="WA">
                    <h2 class="text-2xl font-light text-[#e9edef]">WhatsApp Web</h2>
                    <p class="text-[#8696a0] text-sm mt-4">Send and receive messages with NYC (+1 212) or Toronto (+1 416) numbers.</p>
                </div>

                <div id="chat-ui" class="hidden h-full flex flex-col">
                    <header class="dark-header p-3 flex justify-between items-center shadow-md z-20">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-arrow-left md:hidden text-[#8696a0]" onclick="closeChatMobile()"></i>
                            <img id="active-p-dp" src="" class="w-10 h-10 rounded-full object-cover">
                            <div>
                                <h4 id="active-p-name" class="font-bold text-sm text-[#e9edef] flex items-center">Name</h4>
                                <p class="text-[11px] text-[#8696a0]">online</p>
                            </div>
                        </div>
                        <div class="flex space-x-6 text-[#8696a0] mr-2">
                            <i class="fas fa-video"></i>
                            <i class="fas fa-phone-alt"></i>
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                    </header>

                    <div id="messages-wall" class="flex-1 overflow-y-auto p-5 flex flex-col no-scrollbar" style="background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay;">
                        </div>

                    <div class="p-2 flex items-center space-x-2 bg-[#202c33]">
                        <div class="flex-1 flex items-center bg-[#2a3942] rounded-full px-4 py-2">
                            <i class="far fa-face-smile text-[#8696a0] text-xl mr-3"></i>
                            <input type="text" id="msg-input-field" onkeypress="checkEnter(event)" placeholder="Type a message" class="flex-1 bg-transparent outline-none text-[#e9edef] text-sm">
                            <i class="fas fa-paperclip text-[#8696a0] text-lg rotate-45 ml-3"></i>
                        </div>
                        <button onclick="dispatchDivineMsg()" class="w-12 h-12 bg-[#00a884] text-white rounded-full flex items-center justify-center shadow-lg">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div id="profile-modal" class="hidden fixed inset-0 z-[600] bg-black">
        <div class="max-w-md mx-auto h-full flex flex-col profile-view">
            <header class="p-6 flex items-center space-x-8">
                <i class="fas fa-arrow-left text-[#e9edef] text-xl cursor-pointer" onclick="closeProfile()"></i>
                <h3 class="text-[#e9edef] text-xl">Profile</h3>
            </header>
            
            <div class="flex-1 overflow-y-auto no-scrollbar pb-10">
                <div class="py-10 flex flex-col items-center">
                    <div class="relative">
                        <img id="my-big-dp" src="" class="w-52 h-52 rounded-full object-cover">
                    </div>
                    <button class="mt-6 edit-green" onclick="alert('Image upload ready')">Edit</button>
                </div>

                <div class="space-y-8 mt-4">
                    <div class="flex px-8 space-x-8">
                        <i class="fas fa-user profile-icon mt-4"></i>
                        <div class="flex-1 border-b border-[#202c33] pb-4">
                            <p class="text-[#8696a0] text-sm">Name</p>
                            <h4 id="my-v-name" class="text-[#e9edef] text-lg mt-1">R K</h4>
                            <p class="text-[#8696a0] text-xs mt-2">This is not your username or pin. This name will be visible to your WhatsApp contacts.</p>
                        </div>
                        <i class="fas fa-pencil-alt text-[#00a884] mt-10"></i>
                    </div>

                    <div class="flex px-8 space-x-8">
                        <i class="fas fa-info-circle profile-icon mt-1"></i>
                        <div class="flex-1 border-b border-[#202c33] pb-4">
                            <p class="text-[#8696a0] text-sm">About</p>
                            <h4 class="text-[#e9edef] text-sm mt-1 italic">‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§ï‡•â‡§≤‡•ç‡§∏ ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ</h4>
                        </div>
                        <i class="fas fa-pencil-alt text-[#00a884] mt-6"></i>
                    </div>

                    <div class="flex px-8 space-x-8">
                        <i class="fas fa-phone profile-icon mt-1"></i>
                        <div class="flex-1 pb-4">
                            <p class="text-[#8696a0] text-sm">Phone</p>
                            <h4 id="my-v-number" class="text-[#e9edef] text-sm mt-1">+91 62013 21993</h4>
                        </div>
                    </div>

                    <div class="flex px-8 space-x-8">
                        <i class="fas fa-link profile-icon mt-1"></i>
                        <div class="flex-1 pb-4">
                            <p class="text-[#8696a0] text-sm">Links</p>
                            <p class="edit-green text-sm mt-1">Add links</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="new-chat-modal" class="hidden fixed inset-0 z-[500] bg-black/60 flex items-start pt-20 justify-center p-6">
        <div class="bg-[#233138] w-full max-w-sm rounded-lg shadow-2xl overflow-hidden">
            <div class="p-4 bg-[#111b21] text-[#e9edef] flex items-center space-x-6">
                <i class="fas fa-arrow-left cursor-pointer" onclick="closeNewChat()"></i>
                <h3 class="font-bold">New Chat</h3>
            </div>
            <div class="p-6 space-y-6">
                <input type="text" id="search-soul-num" placeholder="Enter NYC or Toronto number (+1...)" class="w-full p-3 bg-transparent border-b-2 border-[#00a884] outline-none text-[#e9edef] text-sm">
                
                <div id="search-match-box" class="hidden p-4 bg-[#111b21] rounded-lg flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <img id="match-dp" src="" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <p id="match-name" class="font-bold text-sm text-[#e9edef]">Name</p>
                            <p id="match-num" class="text-xs text-[#8696a0]">+1...</p>
                        </div>
                    </div>
                    <button onclick="startConvo()" class="text-[#00a884] font-bold text-sm uppercase">Chat</button>
                </div>
                
                <button onclick="scanGlobalJanat()" class="w-full bg-[#00a884] text-white py-3 rounded font-bold uppercase text-sm shadow-lg">Find Angel</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * WHATSAPP CLONE ENGINE V15
         * DARK MODE & NYC PROTOCOLS
         */

        let me = null;
        let pAvatar = "";
        let chatTarget = null;
        let registerMode = false;

        const dbFetch = (k) => JSON.parse(localStorage.getItem(k) || "[]");
        const dbSave = (k, v) => localStorage.setItem(k, JSON.stringify(v));

        window.onload = () => {
            const session = localStorage.getItem('wa_sess_v15');
            if(session) launchApp(JSON.parse(session));
        };

        function switchAuthMode(reg) {
            registerMode = reg;
            document.getElementById('login-fields').classList.toggle('hidden', reg);
            document.getElementById('reg-fields').classList.toggle('hidden', !reg);
            document.getElementById('toggle-label').innerText = reg ? "Already have account? Login" : "New to WhatsApp? Register";
        }

        function readDP(input) {
            const r = new FileReader();
            r.onload = (e) => pAvatar = e.target.result;
            r.readAsDataURL(input.files[0]);
        }

        function handleSystemAuth() {
            if(registerMode) {
                const name = document.getElementById('r-name').value.trim();
                const user = document.getElementById('r-user').value.toLowerCase().trim();
                const pass = document.getElementById('r-pass').value.trim();
                if(!name || !user || !pass) return alert("All fields are required!");

                let users = dbFetch('wa_users_v15');
                if(users.some(u => u.user === user)) return alert("Username already taken!");

                // üî• ELITE NUMBERS LOGIC üî•
                let num = "";
                if(user === 'amar') num = `+1 (212) 777-8888`; // NYC
                else if(user === 'amarkumar') num = `+1 (416) 999-0000`; // Toronto
                else num = `+91 ${Math.floor(6000000000 + Math.random() * 3999999999)}`;

                const data = { name, user, pass, num, dp: pAvatar || `https://ui-avatars.com/api/?name=${name}&background=00a884&color=fff`, contacts: [] };
                users.push(data);
                dbSave('wa_users_v15', users);
                alert(`Identity Verified! Your Number: ${num}`);
                switchAuthMode(false);
            } else {
                const user = document.getElementById('l-user').value.toLowerCase().trim();
                const pass = document.getElementById('l-pass').value.trim();
                const users = dbFetch('wa_users_v15');
                const found = users.find(u => u.user === user && u.pass === pass);
                if(found) {
                    localStorage.setItem('wa_sess_v15', JSON.stringify(found));
                    launchApp(found);
                } else alert("Invalid identity!");
            }
        }

        function launchApp(data) {
            me = data;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            refreshDirectory();
        }

        // --- 3-DOT MENU & PROFILE ---
        function toggleMenu() { document.getElementById('menu-dropdown').classList.toggle('hidden'); }
        
        function viewMyProfile() {
            toggleMenu();
            document.getElementById('profile-modal').classList.remove('hidden');
            document.getElementById('my-v-name').innerText = me.name;
            document.getElementById('my-v-number').innerText = me.num;
            document.getElementById('my-big-dp').src = me.dp;
        }

        function closeProfile() { document.getElementById('profile-modal').classList.add('hidden'); }

        // --- DIRECTORY PROTOCOL ---
        function showNewChatModal() { toggleMenu(); document.getElementById('new-chat-modal').classList.remove('hidden'); }
        function closeNewChat() { 
            document.getElementById('new-chat-modal').classList.add('hidden');
            document.getElementById('search-match-box').classList.add('hidden');
        }

        let foundSoul = null;
        function scanGlobalJanat() {
            const num = document.getElementById('search-soul-num').value.trim();
            const users = dbFetch('wa_users_v15');
            foundSoul = users.find(u => u.num === num);
            if(foundSoul) {
                if(foundSoul.user === me.user) return alert("This is your own number!");
                document.getElementById('search-match-box').classList.remove('hidden');
                document.getElementById('match-dp').src = foundSoul.dp;
                document.getElementById('match-name').innerText = foundSoul.name;
                document.getElementById('match-num').innerText = foundSoul.num;
            } else alert("No account linked to this number!");
        }

        function startConvo() {
            let db = dbFetch('wa_users_v15');
            let myIdx = db.findIndex(u => u.user === me.user);
            if(!db[myIdx].contacts.some(c => c.user === foundSoul.user)) {
                db[myIdx].contacts.push(foundSoul);
                dbSave('wa_users_v15', db);
            }
            closeNewChat();
            refreshDirectory();
            openActiveChat(foundSoul.user);
        }

        function refreshDirectory() {
            const wall = document.getElementById('chat-threads-wall');
            const users = dbFetch('wa_users_v15');
            const latestMe = users.find(u => u.user === me.user);
            
            if(!latestMe.contacts || latestMe.contacts.length === 0) {
                wall.innerHTML = `<p class="text-center text-gray-500 text-sm mt-20 italic">No chats yet. Use 3-dots menu for New Chat.</p>`;
                return;
            }

            wall.innerHTML = latestMe.contacts.map(c => `
                <div class="chat-list-item flex items-center space-x-4 p-4 border-b border-[#202c33] cursor-pointer transition" onclick="openActiveChat('${c.user}')">
                    <img src="${c.dp}" class="w-14 h-14 rounded-full object-cover">
                    <div class="flex-1 overflow-hidden">
                        <div class="flex justify-between items-center">
                            <h4 class="font-bold text-[#e9edef] flex items-center truncate">${c.name} ${(c.user === 'amar' || c.user === 'amarkumar') ? '<i class="fas fa-check-circle blue-tick-wa ml-2"></i>' : ''}</h4>
                            <span class="text-[11px] text-[#8696a0]">12:45 PM</span>
                        </div>
                        <p class="text-xs text-[#8696a0] truncate mt-1">${c.num}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- CHAT PROTOCOL ---
        function openActiveChat(u) {
            const users = dbFetch('wa_users_v15');
            chatTarget = users.find(x => x.user === u);
            document.getElementById('no-chat').classList.add('hidden');
            document.getElementById('chat-ui').classList.remove('hidden');
            document.getElementById('active-p-dp').src = chatTarget.dp;
            document.getElementById('active-p-name').innerText = chatTarget.name;
            
            if(chatTarget.user === 'amar' || chatTarget.user === 'amarkumar') {
                document.getElementById('active-p-name').innerHTML += ' <i class="fas fa-check-circle blue-tick-wa"></i>';
            }

            renderMessages();
            if(window.innerWidth < 850) document.querySelector('.chat-viewport').classList.add('active');
        }

        function checkEnter(e) { if(e.key === 'Enter') dispatchDivineMsg(); }

        function dispatchDivineMsg() {
            const inp = document.getElementById('msg-input-field');
            if(!inp.value.trim() || !chatTarget) return;
            let chats = dbFetch('wa_chats_v15');
            chats.push({ 
                from: me.user, 
                to: chatTarget.user, 
                text: inp.value.trim(), 
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) 
            });
            dbSave('wa_chats_v15', chats);
            inp.value = "";
            renderMessages();
        }

        function renderMessages() {
            const wall = document.getElementById('messages-wall');
            const chats = dbFetch('wa_chats_v15');
            const thread = chats.filter(c => (c.from === me.user && c.to === chatTarget.user) || (c.from === chatTarget.user && c.to === me.user));

            wall.innerHTML = thread.map(m => `
                <div class="msg-box ${m.from === me.user ? 'msg-me' : 'msg-them'}">
                    <span>${m.text}</span>
                    <span class="float-right text-[10px] text-[#8696a0] mt-1.5 ml-2">${m.time} ${m.from === me.user ? '<i class="fas fa-check-double text-[#53bdeb]"></i>' : ''}</span>
                </div>
            `).join('');
            wall.scrollTop = wall.scrollHeight;
        }

        function closeChatMobile() { document.querySelector('.chat-viewport').classList.remove('active'); }
        function logout() { localStorage.removeItem('wa_sess_v15'); location.reload(); }

        /**
         * ENGINE V15 BUFFER TARGET REACHED
         * DARK REPLICA SECURED.
         */
    </script>
</body>
</html>
